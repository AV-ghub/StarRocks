# –ì–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ row-store, —Ö–æ–ª–æ–¥–Ω—ã–µ –≤ column-store
–°—Ö–µ–º–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ Citus.  
–í StarRocks **–ø—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞** —Ç–∞–∫–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π tiered-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã **–Ω–µ—Ç**, –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.

### ‚öôÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä

| –ê—Å–ø–µ–∫—Ç | **Citus** | **StarRocks** |
| :--- | :--- | :--- |
| **–ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –Ø–≤–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: **row-store** –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, **column-store** –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö. | **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ columnar storage** —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. |
| **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** | **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è** —á–µ—Ä–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —É—Å–ª–æ–≤–∏–π. | **–†—É—á–Ω–∞—è** –∏–ª–∏ **–ø–æ–ª—É–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è** —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. |
| **–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º** | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è. | –ì–∏–±—Ä–∏–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, TTL, –≤–Ω–µ—à–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, —Ä—É—á–Ω–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. |

### üõ†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤ StarRocks

#### 1. **–ì–∏–±—Ä–∏–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (Primary Key + `STORE_TYPE = 'column_with_row'`)**

–≠—Ç–æ **–Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–π –∞–Ω–∞–ª–æ–≥** –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å TTL
CREATE TABLE orders (
    order_id BIGINT,
    user_id INT,
    order_data JSON,
    created_at DATETIME,
    -- ...
    PRIMARY KEY (order_id)
) 
PARTITION BY RANGE(created_at) (
    START ("2024-01-01") END ("2024-07-01") EVERY (INTERVAL 1 MONTH)
)
DISTRIBUTED BY HASH(order_id)
PROPERTIES (
    "store_type" = "column_with_row",  -- –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
    "replication_num" = "3"
);
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
*   **–°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏): —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç —Ç–æ—á–µ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Short Circuit Scan
*   **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** (—Å—Ç–∞—Ä—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏): —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —á–∏—Å—Ç–æ –∫–æ–ª–æ–Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
*   **TTL** –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π

#### 2. **–†—É—á–Ω–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**

–ë–æ–ª–µ–µ –≥–∏–±–∫–∏–π, –Ω–æ —Ç—Ä–µ–±—É—é—â–∏–π —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥.

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è "–≥–æ—Ä—è—á–∏—Ö" –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
CREATE TABLE orders_current (
    order_id BIGINT,
    -- –ø–æ–ª—è...
    created_at DATETIME,
    PRIMARY KEY (order_id)
) 
PARTITION BY RANGE(created_at) (
    PARTITION p202406 VALUES [('2024-06-01'), ('2024-07-01'))
)
PROPERTIES ("store_type" = "column_with_row");

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è "—Ö–æ–ª–æ–¥–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö (–∞—Ä—Ö–∏–≤)
CREATE TABLE orders_archive (
    order_id BIGINT,
    -- –ø–æ–ª—è...
    created_at DATETIME
)
PARTITION BY RANGE(created_at) (
    PARTITION p202401 VALUES [('2024-01-01'), ('2024-02-01')),
    PARTITION p202402 VALUES [('2024-02-01'), ('2024-03-01'))
    -- ...
);
```

**–ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏:**
```sql
-- 1. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Ä–∞–∑ –≤ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é)
INSERT INTO orders_archive 
SELECT * FROM orders_current 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- 2. –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
DELETE FROM orders_current 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- 3. –ï–¥–∏–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VIEW
CREATE VIEW orders_all AS
SELECT * FROM orders_current
UNION ALL
SELECT * FROM orders_archive;
```

#### 3. **–í–Ω–µ—à–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏ –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ö–∏–≤—ã –≤ –¥–µ—à–µ–≤–æ–º –æ–±—ä–µ–∫—Ç–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

```sql
-- –ì–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ StarRocks
CREATE TABLE orders_hot (
    order_id BIGINT,
    created_at DATETIME,
    -- ...
    PRIMARY KEY (order_id)
) PROPERTIES ("store_type" = "column_with_row");

-- –•–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Parquet –Ω–∞ S3
CREATE EXTERNAL TABLE orders_cold (
    order_id BIGINT,
    created_at DATETIME,
    -- ...
) PROPERTIES (
    "type" = "hive",
    "database" = "archive",
    "table" = "orders"
);
```

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞

–î–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (cron, Airflow, DolphinScheduler)**
- **–°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ TTL-–ø—Ä–∞–≤–∏–ª
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Ä–∞–∑–º–µ—Ä–∞ –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üí° –ö–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ?

–ü—Ä–µ–∂–¥–µ —á–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –æ—Ü–µ–Ω–∏—Ç–µ:

1.  **–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ –≥–∏–±—Ä–∏–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è?** –ß–∞—Å—Ç–æ –∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ö–≤–∞—Ç–∞–µ—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
2.  **–ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?** –ï—Å–ª–∏ –º–µ–Ω–µ–µ 10-20%, –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ—â–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ.
3.  **–ù–∞—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤?**

### üéØ –í—ã–≤–æ–¥

**–ü—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ Citus —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π –≤ StarRocks –Ω–µ—Ç**, –Ω–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è **–≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü + –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã** –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—Å—Ç–∏—á—å –ø–æ—Ö–æ–∂–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –Ω–æ –¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

–î–ª—è –º–Ω–æ–≥–∏—Ö —Å–ª—É—á–∞–µ–≤ **–≥–∏–±—Ä–∏–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å TTL** –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å –∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ, –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
