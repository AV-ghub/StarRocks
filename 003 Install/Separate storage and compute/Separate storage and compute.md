# [Separate storage and compute](https://docs.starrocks.io/docs/quick_start/shared-data/)

Hot _**data is cached locally**_ and When the cache is hit, the query performance is comparable to that of storage-compute coupled architecture.  
Compute nodes _**(CN) can be added**_ or removed on demand _**within seconds**_.  
This architecture _**reduces storage cost**_, ensures _**better resource isolation**_, and provides _**elasticity and scalability**_.

## Prerequisites
4 GB RAM assigned to Docker
```
docker stats
```
–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã MEM USAGE –∏ LIMIT.

### –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Docker
```
sudo docker info | grep "Docker Root Dir"
 Docker Root Dir: /var/lib/docker
```
### –ù–∞–π—Ç–∏ –≤—Å–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–º–∞
```
sudo docker inspect -f '{{ range .Mounts }}{{ .Source }} -> {{ .Destination }}{{ "\n" }}{{ end }}' quickstart

```
### –£–≤–∏–¥–µ—Ç—å —Ä–∞–±–æ—á—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
```
sudo docker inspect -f '{{ .GraphDriver.Data.MergedDir }}' quickstart
/var/lib/docker/overlay2/61b9118a06f02d00703837142aad9b964f3f006441e9642778b3566e19dd99b7/merged
```

–ò—Ç–æ–≥–æ –¥–µ–ª–∞–µ–º –≤—ã–≤–æ–¥, —á—Ç–æ –±–∞–∑–∞ —É –Ω–∞—Å –≤ –¥–æ–∫–µ—Ä–µ, –∞ –¥–æ–∫–µ—Ä –Ω–∞ —Ä—É—Ç–µ.   
–¢.–µ. –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö —É –Ω–∞—Å –ø—Ä–æ—Å–∞–¥–∏—Ç —Ä—É—Ç–æ–≤—ã–π –¥–∏—Å–∫, –Ω–æ –º–µ—Å—Ç–æ –Ω–∞ –Ω–µ–º —É –Ω–∞—Å –µ—â–µ –µ—Å—Ç—å:
```
df -h /dev/mapper/almalinux_igonin--vl-root 
–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞                      –†–∞–∑–º–µ—Ä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ  –î–æ—Å—Ç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ% C–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤
/dev/mapper/almalinux_igonin--vl-root    70G          32G   39G           46% /
```
## [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](https://docs.starrocks.io/docs/quick_start/shared-data/#deploy-starrocks-and-minio)
–í –ø—Ä–æ—Ü–µ—Å—Å–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É –Ω–∞—Å –ø—Ä–æ–±–ª–µ–º–∞
```
[+] Running 4/5
 ‚úî Network ssc_default       Created                                                                                                                                                                       4.0s 
 ‚†º Container minio           Starting                                                                                                                                                                     74.9s 
 ‚úî Container starrocks-fe    Created                                                                                                                                                                       0.2s 
 ‚úî Container ssc-minio_mc-1  Created                                                                                                                                                                       0.2s 
 ‚úî Container starrocks-cn    Created                                                                                                                                                                       0.3s 
Error response from daemon: failed to set up container networking: driver failed programming external connectivity on endpoint minio (5c65c33ad8dff4293f10a18ae3c1d193d6cd19c4022b352a2d80fccbc3e39add): failed to bind host port for 0.0.0.0:9000:172.19.0.2:9000/tcp: address already in use
```
—á—Ç–æ –ø–æ–Ω—è—Ç–Ω–æ, –∏–±–æ —É –Ω–∞—Å ClickHouse.  
–î–∞–ª–µ–µ.   

–û—à–∏–±–∫–∞ `address already in use` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ—Ä—Ç 9000 –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ —É–∂–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º (–≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî ClickHouse).  
–†–µ—à–∞–µ—Ç—Å—è —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ `docker-compose.yml`.

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—Ä—Ç 9000 –∑–∞–Ω—è—Ç, –∏ –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ—Ä—Ç—ã, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã.

- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 9000:**
    ```bash
    sudo lsof -i :9000
    COMMAND    PID       USER   FD   TYPE    DEVICE SIZE/OFF NODE NAME
    clickhous 8331 clickhouse   43u  IPv4 145100358      0t0  TCP *:cslistener (LISTEN)
    ```
    –ò–ª–∏, –µ—Å–ª–∏ `lsof` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
    ```bash
    sudo netstat -tulpn | grep :9000
    tcp        0      0 0.0.0.0:9000            0.0.0.0:*               LISTEN      8331/clickhouse-ser 
    ```
    –ö–æ–º–∞–Ω–¥–∞ –ø–æ–∫–∞–∂–µ—Ç PID –∏ –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω—è–ª –ø–æ—Ä—Ç.
  
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ—Ä—Ç—ã:**
  ```
  sudo netstat -tulpn | grep :9
  tcp        0      0 0.0.0.0:9030            0.0.0.0:*               LISTEN      855130/docker-proxy 
  tcp        0      0 0.0.0.0:9009            0.0.0.0:*               LISTEN      8331/clickhouse-ser 
  tcp        0      0 0.0.0.0:9002            0.0.0.0:*               LISTEN      478156/docker-proxy 
  tcp        0      0 0.0.0.0:9001            0.0.0.0:*               LISTEN      478138/docker-proxy 
  tcp        0      0 0.0.0.0:9000            0.0.0.0:*               LISTEN      8331/clickhouse-ser 
  tcp        0      0 0.0.0.0:9005            0.0.0.0:*               LISTEN      8331/clickhouse-ser 
  tcp        0      0 0.0.0.0:9004            0.0.0.0:*               LISTEN      8331/clickhouse-ser 
  tcp        0      0 0.0.0.0:9901            0.0.0.0:*               LISTEN      478181/docker-proxy 
  tcp        0      0 0.0.0.0:9900            0.0.0.0:*               LISTEN      478453/docker-proxy 
  ```
  ```
  sudo netstat -tulpn | grep :8
  tcp        0      0 0.0.0.0:8030            0.0.0.0:*               LISTEN      855074/docker-proxy 
  tcp        0      0 0.0.0.0:8040            0.0.0.0:*               LISTEN      855115/docker-proxy 
  tcp        0      0 0.0.0.0:8085            0.0.0.0:*               LISTEN      478624/docker-proxy 
  tcp        0      0 0.0.0.0:8123            0.0.0.0:*               LISTEN      8331/clickhouse-ser 
  tcp        0      0 0.0.0.0:8113            0.0.0.0:*               LISTEN      479376/docker-proxy 
  tcp        0      0 0.0.0.0:8112            0.0.0.0:*               LISTEN      479359/docker-proxy 
  ```
  
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å ClickHouse:**
    ```bash
    sudo systemctl status clickhouse-server
    ```

### üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker Compose

–ß—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è MinIO –≤ —Ñ–∞–π–ª–µ `docker-compose.yml`, —Å–∫–∞—á–∞–Ω–Ω—ã–π –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ StarRocks.

1.  **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml`** –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ.
2.  **–ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é, –æ–ø–∏—Å—ã–≤–∞—é—â—É—é —Å–µ—Ä–≤–∏—Å `minio`.** –û–Ω–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
    ```yaml
    minio:
      # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...
      ports:
        - 9001:9001
        - 9000:9000
    ```
3.  **–ò–∑–º–µ–Ω–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç –¥–ª—è `9000`** –Ω–∞ –ª—é–±–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `9500`):
    ```yaml
      ports:
        - 9501:9001
        - 9500:9000  # –ò–∑–º–µ–Ω—è–µ–º –ª–µ–≤—É—é —á–∞—Å—Ç—å (—Ö–æ—Å—Ç:–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
    ```
    –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ—Ä—Ç 9000 –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ MinIO –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 9500.
4.  **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

### üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–µ –æ–±–Ω–æ–≤–∏—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

1.  **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ —É–¥–∞–ª–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.** –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å `docker-compose.yml`:
    ```bash
    sudo docker compose down
    ```
2.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–Ω–æ–≤–æ:**
    ```bash
    sudo docker compose up -d
    ```
    –¢–µ–ø–µ—Ä—å MinIO –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫, –∞ –µ–≥–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:9901`, –∞ S3 API ‚Äî –Ω–∞ –ø–æ—Ä—Ç—É `9900`.

### üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä—É–≥–∏–µ –ø–æ—Ä—Ç—ã:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥—Ä—É–≥–∏–µ –ø–æ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç StarRocks (9030, 8030, 8040), —Ç–∞–∫–∂–µ —Å–≤–æ–±–æ–¥–Ω—ã. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Ö –º–æ–∂–Ω–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—è—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ `starrocks-fe` –∏ `starrocks-be` –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ `docker-compose.yml`.
- **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç–∞ MinIO –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ä—Ç (`9900`) –≤–æ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `STORAGE VOLUME` –≤ StarRocks.





































