> –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø–æ—Ç–æ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç —á—Ç–æ-—Ç–æ –≤—ã—á–∏—Ç—ã–≤–∞—Ç—å –∏–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞,  
> –ø–æ—Å–ª–µ –µ–≥–æ –≤—ã—á–∏—Ç—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã–µ —Ç–∞–º –æ–±–Ω—É–ª—è—é—Ç—Å—è  
> –∏ –≤—Ç–æ—Ä–æ–º—É (–∏ —Å–ª–µ–¥—É—é—â–∏–º) –ø–æ—Ç–æ–∫—É —É–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ—Å—Ç–∞–µ—Ç—Å—è
> –æ—Ç—Å—é–¥–∞ –∏–¥–µ—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –æ—Ç–ø—É—Å—Ç–∏–≤ –∏—Å—Ç–æ—á–Ω–∏–∫
> –∞ —É–∂–µ –ø–æ—Ç–æ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å –∏—Ö –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º

##### ...\Work\Tasks\CS-28826 –†–¢–ö. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å BI –Ω–∞ demo —Å—Ç–µ–Ω–¥–µ\cdc\Apache Flink\Test\Streaming ELT from PostgreSQL to StarRocks with Flink SQL one PG slot to many tables threding.sql

–ê, –≤–æ—Ç —Ç–µ–ø–µ—Ä—å —è –ø–æ–Ω–∏–º–∞—é –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã!   
–í—ã –≥–æ–≤–æ—Ä–∏—Ç–µ –ø—Ä–æ **–º–µ—Ö–∞–Ω–∏–∑–º —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL CDC**, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫: –∫–æ–≥–¥–∞ —Å–ª–æ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤—ã—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, –æ–Ω–∏ "–∏—Å—á–µ–∑–∞—é—Ç" –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π.

## üéØ –†–µ—à–µ–Ω–∏–µ: –û–î–ò–ù –ø–æ—Ç–æ–∫ —Å branching (—Ä–∞–∑–≤–µ—Ç–≤–ª–µ–Ω–∏–µ–º)

–í–∞–º –Ω—É–∂–µ–Ω **–æ–¥–∏–Ω Flink Job**, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ç–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫ –Ω–∞ –¥–≤–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```sql
-- 1. –°–æ–∑–¥–∞–µ–º –û–î–ò–ù –∏—Å—Ç–æ—á–Ω–∏–∫ (—É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å dbo_dict_cdc_source)

-- 2. –°–æ–∑–¥–∞–µ–º –¥–≤–∞ TEMPORARY VIEW –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö "–Ω–∞ –ª–µ—Ç—É"
CREATE TEMPORARY VIEW IF NOT EXISTS constants_stream AS
SELECT 
  CAST(constantid AS STRING) as constantid_str,
  constantid,
  key,
  value,
  description,
  insertutcdate,
  extraf,
  extraf_1
FROM `default_catalog`.`cdctest`.`dbo_dict_cdc_source`
WHERE constantid IS NOT NULL;

CREATE TEMPORARY VIEW IF NOT EXISTS enumdescriptor_stream AS
SELECT 
  CAST(enumdescriptorid AS STRING) as enumdescriptorid_str,
  enumdescriptorid,
  enumtypeid,
  name,
  CAST(value AS BIGINT) as value_bigint, -- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞
  languageresourceid,
  insertutcdate
FROM `default_catalog`.`cdctest`.`dbo_dict_cdc_source`
WHERE enumdescriptorid IS NOT NULL;

-- 3. –í—Å—Ç–∞–≤–ª—è–µ–º –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û –≤ –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –û–î–ù–û–ì–û –∏—Å—Ç–æ—á–Ω–∏–∫–∞
BEGIN STATEMENT SET;

INSERT INTO `default_catalog`.`cdctest`.`dbo__constants_sink`
SELECT 
  constantid,
  key,
  value,
  description,
  insertutcdate,
  extraf,
  extraf_1
FROM constants_stream;

INSERT INTO `default_catalog`.`cdctest`.`dbo__enumdescriptor_sink`
SELECT 
  enumdescriptorid,
  enumtypeid,
  name,
  value_bigint as value,
  languageresourceid,
  insertutcdate
FROM enumdescriptor_stream;

END;
```

## üîß –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–û–¥–∏–Ω —Å–ª–æ—Ç, –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** - –∏—Å—Ç–æ—á–Ω–∏–∫ `dbo_dict_cdc_source` —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ **–æ–¥–∏–Ω —Ä–∞–∑**
2. **Branching** - Flink –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–Ω–æ–∂–∞–µ—Ç –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–≤—É—Ö `INSERT` –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ VIEW** - `WHERE constantid IS NOT NULL` –∏ `WHERE enumdescriptorid IS NOT NULL` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –ø–æ–ø–∞–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–π sink

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
flowchart TD
    P[(PostgreSQL<br>CDC Slot)]
    S[–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫<br>dbo_dict_cdc_source]
    
    subgraph F [Flink Job - –æ–¥–∏–Ω –ø–æ—Ç–æ–∫]
        S --> V1[VIEW: constants_stream<br>WHERE constantid NOT NULL]
        S --> V2[VIEW: enumdescriptor_stream<br>WHERE enumdescriptorid NOT NULL]
        
        V1 --> I1[INSERT INTO<br>constants_sink]
        V2 --> I2[INSERT INTO<br>enumdescriptor_sink]
    end
    
    I1 --> SR1[(StarRocks<br>constants)]
    I2 --> SR2[(StarRocks<br>enumdescriptor)]
    
    P -- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ --> S
```

## ‚ö†Ô∏è –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–º–µ–Ω–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

–ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∞ –ø–æ—Ç–æ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Kafka –∫–∞–∫ –±—É—Ñ–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```sql
-- 1. –ò—Å—Ç–æ—á–Ω–∏–∫ ‚Üí Kafka
CREATE TABLE cdc_kafka_sink (
  `constantid` STRING,
  `enumdescriptorid` STRING,
  `key` STRING,
  `value` STRING,
  ...
) WITH (
  'connector' = 'kafka',
  'topic' = 'cdc_raw_data',
  'properties.bootstrap.servers' = 'localhost:9092',
  'format' = 'json'
);

-- 2. –í—Å—Ç–∞–≤–ª—è–µ–º –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ Kafka
INSERT INTO cdc_kafka_sink 
SELECT * FROM dbo_dict_cdc_source;

-- 3. –í –¥—Ä—É–≥–æ–º Job'–µ —á–∏—Ç–∞–µ–º –∏–∑ Kafka –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–∫ checkpoint
```sql
-- –°–æ—Ö—Ä–∞–Ω—è–µ–º snapshot –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
CREATE TABLE temp_snapshot (
  ...
) WITH (
  'connector' = 'filesystem',
  'path' = 'file:///tmp/cdc_snapshot',
  'format' = 'json'
);

INSERT INTO temp_snapshot SELECT * FROM dbo_dict_cdc_source;
-- –ü–æ—Ç–æ–º —á–∏—Ç–∞–µ–º –∏–∑ temp_snapshot –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
```

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å branching** - —ç—Ç–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± –≤–æ Flink –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏. –í—Å—è –º–∞–≥–∏—è –≤ `BEGIN STATEMENT SET; ... END;` - —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±–∞ `INSERT` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö **–æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** —á—Ç–µ–Ω–∏—è –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

–ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç SQL-—Å–∫—Ä–∏–ø—Ç —Ü–µ–ª–∏–∫–æ–º –≤ SQL Client, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ–¥–∏–Ω Job, –∫–æ—Ç–æ—Ä—ã–π:
1. –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL –æ–¥–∏–Ω —Ä–∞–∑
2. –†–∞–∑–¥–µ–ª—è–µ—Ç –∏—Ö –Ω–∞ –¥–≤–∞ –ø–æ—Ç–æ–∫–∞
3. –ü–∏—à–µ—Ç –≤ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã StarRocks
