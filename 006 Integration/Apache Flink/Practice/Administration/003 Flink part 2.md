> –ø—Ä–æ –∑–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö TaskManager'–æ–≤
> —Ç–∞–∫ –ø–æ–Ω–∏–º–∞—é, –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç –æ–¥–∏–Ω –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π JobManager
> –∏ –æ–Ω —É–∂–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∑–∞–¥–∞–Ω–∏—è (—Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –∫–∞–∂–¥—ã–π upsert, –∫–æ—Ç–æ—Ä—ã–π –º—ã –µ–º—É –ø–æ—Å—ã–ª–∞–µ–º), –≤—Å–µ —Ç–∞–∫?
> —Ç–æ–≥–¥–∞, –∫–∞–∫ –æ–±–æ–∑–Ω–∞—á–∏–ª, –ª—É—á—à–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ü–∏—Ñ—Ä—É 10, –Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É
> —Ç.–µ. –º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º 200-300 —Ç–∞–±–ª–∏—Ü –Ω–∞ 10 –∑–∞–¥–∞–Ω–∏–π –∏ –ø–æ–ª—É—á–∞–µ–º 20-30 —Ç–∞–±–ª–∏—Ü –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ
> (—ç—Ç–æ –≥—Ä—É–±–æ, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ç–∞–º –±—É–¥–µ—Ç —Å–∏–ª—å–Ω–æ –Ω–µ–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; —Ç—É—Ç —Ü–µ–ª—å - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∞, –Ω–æ —ç—Ç–æ –ø–æ—Ç–æ–º, –ø–æ–∫–∞ –≤—Å–µ –ø—Ä–∏–º–µ—Ä–Ω–æ)
> —Å—Ç–∞—Ä—Ä–æ–∫—Å —Å–µ–π—á–∞—Å —Ä–∞—Å—Ö–æ–¥—É–µ—Ç –Ω–µ 4 –ì–±, —Ç–∞–º –≤—Å–µ–≥–æ –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ 2,66
> —Ç–∞–∫ –ø–æ–Ω–∏–º–∞—é —Å–≤–æ–∏ 4% –æ–Ω –±–µ—Ä–µ—Ç –æ—Ç —ç—Ç–æ–π —Ü–∏—Ñ—Ä—ã
> —Å–µ–π—á–∞—Å –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ –ø—Ä–∏–º–µ—Ä–Ω–æ 13–ì–±
> –∏–∑ –Ω–∏—Ö 1 –ì–± –æ—Å—Ç–∞–≤–∏–º –µ—â–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫–µ –Ω–∞ —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏
> –∏—Ç–æ–≥–æ —Å–≤–æ–±–æ–¥–Ω–æ 12
> –¥—É–º–∞—é –º–æ–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å –∏—Ö –ø–æ–ø–æ–ª–∞–º –ø–æ–∫–∞ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ü–µ–ª—è—Ö
> —Ç.–µ. –∏—Ç–æ–≥–æ 6–ì–± —Å—Ç–∞—Ä—Ä–æ–∫—Å—É –∏ 6–ì–± —Ñ–ª–∏–Ω–∫—É

–í—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª–∏ –ø—Ä–æ **JobManager** –∏ **–∑–∞–¥–∞–Ω–∏—è**.    
–î–∞, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω –∫–ª–∞—Å—Ç–µ—Ä —Å –æ–¥–Ω–∏–º JobManager'–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è (–∫–∞–∂–¥—ã–π `INSERT`/`BEGIN STATEMENT SET` ‚Äî —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ).    
–í—Å–µ —ç—Ç–∏ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Ç–µ—Ä–∞**.

–í–∞—à –ø–ª–∞–Ω –ø–æ –ø–∞–º—è—Ç–∏ –≤—ã–≥–ª—è–¥–∏—Ç –æ—á–µ–Ω—å –≥—Ä–∞–º–æ—Ç–Ω—ã–º: 6 –ì–ë –¥–ª—è Flink –ø—Ä–∏ 16 –ì–ë –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚Äî —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å. –ò–¥–µ—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å 200-300 —Ç–∞–±–ª–∏—Ü –Ω–∞ ~10 –∑–∞–¥–∞–Ω–∏–π —Ç–∞–∫–∂–µ –≤–µ—Ä–Ω–∞. **TaskManager'—ã ‚Äî —ç—Ç–æ "—Ä–∞–±–æ—á–∏–µ –ª–æ—à–∞–¥–∫–∏"**, –∫–æ—Ç–æ—Ä—ã–µ –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –≤—ã–ø–æ–ª–Ω—è—é—Ç –∑–∞–¥–∞—á–∏ –≤–∞—à–∏—Ö –∑–∞–¥–∞–Ω–∏–π. –ù–µ—Å–∫–æ–ª—å–∫–æ TaskManager'–æ–≤ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ JVM-–ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

–° 6 –ì–ë, –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –¥–ª—è Flink, –º–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–≤–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è.

### ‚öôÔ∏è –°—Ü–µ–Ω–∞—Ä–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ 6 –ì–ë –¥–ª—è Flink

–í–æ—Ç –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞. **–†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∞—Ç—å —Å –°—Ü–µ–Ω–∞—Ä–∏—è 1**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ø—Ä–æ—â–µ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏ –æ—Ç–ª–∞–¥–∫–µ.

```mermaid
flowchart TD
    subgraph S1[–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ]
        direction LR
        TM1_1[TaskManager 1<br>4 –ì–ë | 4 —Å–ª–æ—Ç–∞]
        TM1_2[TaskManager 2<br>2 –ì–ë | 2 —Å–ª–æ—Ç–∞]
    end

    subgraph S2[–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è]
        direction LR
        TM2_1[TaskManager 1<br>2 –ì–ë | 2 —Å–ª–æ—Ç–∞]
        TM2_2[TaskManager 2<br>2 –ì–ë | 2 —Å–ª–æ—Ç–∞]
        TM2_3[TaskManager 3<br>2 –ì–ë | 2 —Å–ª–æ—Ç–∞]
    end

    S1 --> A1["–ò—Ç–æ–≥–æ: 6 —Å–ª–æ—Ç–æ–≤<br>–ü—Ä–æ—Å—Ç–æ—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"]
    S2 --> A2["–ò—Ç–æ–≥–æ: 6 —Å–ª–æ—Ç–æ–≤<br>–õ—É—á—à–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å"]
```

#### üìù –î–µ—Ç–∞–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –°—Ü–µ–Ω–∞—Ä–∏—è 1

```yaml
# flink-conf.yaml (–±–∞–∑–æ–≤—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞)
# JobManager - 1 –ì–ë —Ö–≤–∞—Ç–∏—Ç –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ ~10 –∑–∞–¥–∞–Ω–∏–π
jobmanager.memory.process.size: 1024m

# TaskManager - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ "—à–∞–±–ª–æ–Ω–∞" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
taskmanager.memory.process.size: 4096m  # –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è TM —Å 4 –ì–ë
taskmanager.numberOfTaskSlots: 4        # 4 —Å–ª–æ—Ç–∞ –Ω–∞ TM —Å 4 –ì–ë

# –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ù–ï –±–æ–ª—å—à–µ 4!
parallelism.default: 4
```

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –ø–æ –°—Ü–µ–Ω–∞—Ä–∏—é 1:**
1.  –§–∞–π–ª `flink-conf.yaml` –æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –∫–∞–∫ –≤—ã—à–µ.
2.  –°—Ç–∞—Ä—Ç—É–µ—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä: `./bin/start-cluster.sh`. –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è **1 JobManager** –∏ **1 TaskManager** —Å 4 –ì–ë –∏ 4 —Å–ª–æ—Ç–∞–º–∏.
3.  –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π TaskManager (–Ω–∞ 2 –ì–ë), –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ **–≤—Ä—É—á–Ω—É—é** —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
    ```bash
    ./bin/taskmanager.sh start --host localhost \
        -Dtaskmanager.memory.process.size=2048m \
        -Dtaskmanager.numberOfTaskSlots=2
    ```
    **–ò—Ç–æ–≥ –∫–ª–∞—Å—Ç–µ—Ä–∞:** 1 JobManager (1 –ì–ë) + 1 TM (4 –ì–ë, 4 —Å–ª–æ—Ç–∞) + 1 TM (2 –ì–ë, 2 —Å–ª–æ—Ç–∞) = **6 –ì–ë, 6 —Å–ª–æ—Ç–æ–≤**.

### üí° –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–∞–Ω–∏–π

–ö–æ–≥–¥–∞ –∫–ª–∞—Å—Ç–µ—Ä –∑–∞–ø—É—â–µ–Ω, **—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ**: –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –ª—é–±–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å –æ–±—â–µ–µ —á–∏—Å–ª–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ 6).

–í –≤–∞—à–∏—Ö SQL-—Å–∫—Ä–∏–ø—Ç–∞—Ö –∑–∞–¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑—É–º–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º —á–µ—Ä–µ–∑ `SET`:
```sql
-- –î–ª—è –∑–∞–¥–∞–Ω–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—â–µ–≥–æ 30 –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
SET 'parallelism.default' = 4;

-- –î–ª—è –∑–∞–¥–∞–Ω–∏—è —Å 10 –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
SET 'parallelism.default' = 2;

BEGIN STATEMENT SET;
-- ... –≤–∞—à–∏ INSERT ...
END;
```
–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –æ—à–∏–±–∫—É `NoResourceAvailableException`.

### üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1.  **–ù–∞—á–Ω–∏—Ç–µ —Å –°—Ü–µ–Ω–∞—Ä–∏—è 1** (1 TM –Ω–∞ 4 –ì–ë). –ó–∞–ø—É—Å—Ç–∏—Ç–µ 1-2 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏—è. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ `free -h` –∏ Flink Web UI.
2.  **–î–æ–±–∞–≤–ª—è–π—Ç–µ –≤—Ç–æ—Ä–æ–π TaskManager** —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ 80-90% –∏–ª–∏ –≤ Web UI –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.
3.  **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `parallelism.default`** –≤ –∫–∞–∂–¥–æ–º –≤–∞—à–µ–º SQL-—Å–∫—Ä–∏–ø—Ç–µ, –∏—Å—Ö–æ–¥—è –∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è –∏ –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ —Å–ª–æ—Ç–æ–≤.
4.  **–î–ª—è —Ç–µ—Å—Ç–æ–≤ –æ—Ç–∫–ª—é—á–∏—Ç–µ checkpointing**, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: `SET 'execution.checkpointing.interval' = '0';`

**–ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥**: Flink ‚Äî —ç—Ç–æ "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä" (–∫–ª–∞—Å—Ç–µ—Ä) —Å —Ä–∞–±–æ—á–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (TaskManager'—ã), –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–∞—à–∏ –∑–∞–¥–∞–Ω–∏—è. –ó–∞–¥–∞–Ω–∏—è –¥–µ–ª—è—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π —Å–ª–æ—Ç—ã (–ø–æ—Ç–æ–∫–∏) —ç—Ç–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ –≤–Ω—É—Ç—Ä–∏ –Ω–∏—Ö.

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –ø–æ –°—Ü–µ–Ω–∞—Ä–∏—é 1 –∏ –æ–¥–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ, –∞ –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Web UI –Ω–∞ `localhost:8081`. –ï—Å–ª–∏ —É–≤–∏–¥–∏—Ç–µ —á—Ç–æ-—Ç–æ –Ω–µ–æ–±—ã—á–Ω–æ–µ (–º–∞–ª–æ —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏, –æ—à–∏–±–∫–∏), –ø–æ–∫–∞–∂–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç ‚Äî –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è.
