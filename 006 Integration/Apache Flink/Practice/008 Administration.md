## Monitoring

–ü–µ—Ä–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
sudo apt install htop
sudo apt install sysstat
```

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CPU –∏ –ø–∞–º—è—Ç–∏

–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:

1.  **`top` –∏–ª–∏ `htop`** (–ª—É—á—à–µ, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
    ```
    top
    ```
    *   –í –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ–±—â—É—é –∑–∞–≥—Ä—É–∑–∫—É CPU (`%Cpu(s)`).
    *   –ù–∞–∂–º–∏—Ç–µ `1`, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø–æ —è–¥—Ä–∞–º.
    *   –°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é CPU: `Shift + P` (–≤ `top`).

2.  **`mpstat`** (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É):
    ```
    mpstat 1 5  # –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É, 5 —Ä–∞–∑
    ```
    –°–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–æ–ª–±–µ—Ü `%idle` (–ø—Ä–æ—Å—Ç–æ–π). –ï—Å–ª–∏ –æ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∏–∂–µ 10-20%, CPU –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω.

3.  **–ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ `vmstat`**:
    ```
    vmstat 1 5
    ```
    –ü–µ—Ä–≤—ã–µ –¥–≤–∞ —Å—Ç–æ–ª–±—Ü–∞ –ø–æ—Å–ª–µ `procs` ‚Äî `r` (–ø—Ä–æ—Ü–µ—Å—Å—ã, –æ–∂–∏–¥–∞—é—â–∏–µ CPU) –∏ `b` (—Å–ø—è—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã). –ï—Å–ª–∏ `r` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –±–æ–ª—å—à–µ —á–∏—Å–ª–∞ CPU-—è–¥–µ—Ä ‚Äî –µ—Å—Ç—å –æ—á–µ—Ä–µ–¥—å –∏ –Ω–µ—Ö–≤–∞—Ç–∫–∞ CPU.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–∂–Ω—ã—Ö "–ø–æ–∂–∏—Ä–∞—Ç–µ–ª–µ–π" –ø–∞–º—è—Ç–∏

```bash
# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–∞–º—è—Ç–∏
ps aux --sort=-%mem | head -20
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Flink

`/.../flink-xxx/conf/config.yaml`


```yaml
# –£–ú–ï–ù–¨–®–ò–¢–ï –ü–ê–ú–Ø–¢–¨ –ù–ê –ö–ê–ñ–î–´–ô TASK MANAGER
taskmanager.memory.process.size: 1024m  # 1 –ì–ë –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö 2-4–ì–ë

# –£–ú–ï–ù–¨–®–ò–¢–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –°–õ–û–¢–û–í –ù–ê –û–î–ù–û–ú TM
taskmanager.numberOfTaskSlots: 1  # –û–¥–∏–Ω —Å–ª–æ—Ç –Ω–∞ TM –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–µ=1

# –û–ü–¢–ò–ú–ò–ó–ò–†–£–ô–¢–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ê–ú–Ø–¢–¨–Æ
taskmanager.memory.managed.fraction: 0.3  # –î–æ–ª—è —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏ (–º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å)
```

### SQL-–∫–ª–∏–µ–Ω—Ç Flink

```sql
-- 1. –°–ù–ò–ó–¨–¢–ï –ü–ê–†–ê–õ–õ–ï–õ–ò–ó–ú –î–û –ú–ò–ù–ò–ú–£–ú–ê
Flink SQL> SET 'parallelism.default' = '1';  -- –°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ! –ó–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ

-- 2. –£–ú–ï–ù–¨–®–ò–¢–ï –û–ë–™–Å–ú –°–û–•–†–ê–ù–Ø–ï–ú–û–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–∫–Ω–∞/–∞–≥–≥—Ä–µ–≥–∞—Ç—ã)
Flink SQL> SET 'table.exec.state.ttl' = '60000';  -- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –º—Å (1 –º–∏–Ω—É—Ç–∞ –≤–º–µ—Å—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö 30 –¥–Ω–µ–π)

-- 3. –ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–ï –ó–ê–î–ê–ù–ò–ï
-- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π job —á–µ—Ä–µ–∑ Web UI –∏–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–∞—à INSERT-–∑–∞–ø—Ä–æ—Å –∑–∞–Ω–æ–≤–æ
```

**–í–Ω–∏–º–∞–Ω–∏–µ**: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `/.../flink-xxx/conf/config.yaml` –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Flink.

### üöÄ –ö—Ä–∞—Ç–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1.  **–°—Ä–∞–∑—É –∂–µ** –≤ SQL-–∫–ª–∏–µ–Ω—Ç–µ Flink –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `SET 'parallelism.default' = '1';` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ.
2.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `top` –∏–ª–∏ `htop` ‚Äî –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ CPU –≤—Å—ë –µ—â—ë –±–ª–∏–∑–∫–∞ –∫ 100%, –∑–∞–¥–∞–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ —Ö–æ—Ç—è –±—ã –Ω–µ "—É–ø–∞–¥—ë—Ç" –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏.
3.  –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å ‚Äî –æ—Ç–ª–∏—á–Ω–æ. –ó–∞—Ç–µ–º –º–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `parallelism.default` –¥–æ `2`, –Ω–∞–±–ª—é–¥–∞—è –∑–∞ `free` –∏ `top`.
4.  –ï—Å–ª–∏ –ø–∞–º—è—Ç–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–∞–ª–æ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `/.../flink-xxx/conf/config.yaml` –∏–ª–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## üì¶ SYSSTAT

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
sudo apt update
sudo apt install sysstat
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
mpstat -V
# –∏–ª–∏
which mpstat
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –í–∫–ª—é—á–µ–Ω–∏–µ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω):
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
sudo systemctl status sysstat

# –í–∫–ª—é—á–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl enable sysstat
sudo systemctl start sysstat
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
sudo nano /etc/default/sysstat
```
–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
```bash
ENABLED="true"
```

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mpstat

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –í—ã–≤–æ–¥ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
mpstat

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã, 5 —Ä–∞–∑
mpstat 2 5

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º CPU
mpstat -P ALL

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
mpstat -P ALL 1 3
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –æ–ø—Ü–∏–∏:
- `-P ALL` - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º
- `-u` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `-I SUM` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
- `-V` - –≤–µ—Ä—Å–∏—è —É—Ç–∏–ª–∏—Ç—ã

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –ø–∞–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:
```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
sudo apt update

# –ü–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–∞
apt search sysstat

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è universe
sudo apt-add-repository universe
sudo apt update
sudo apt install sysstat
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
grep -r "universe" /etc/apt/sources.list /etc/apt/sources.list.d/

# –î–æ–±–∞–≤–∏—Ç—å –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
sudo add-apt-repository universe
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
```bash
# –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
apt-cache policy sysstat

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
sudo apt install sysstat=12.2.0-2ubuntu1
```

## üìù –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ mpstat

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
mpstat -P ALL 1 3
```

–ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤—ã–≤–æ–¥:
```
Linux 5.15.0-86-generic (hostname)   11/10/2023  _x86_64_    (4 CPU)

10:30:00  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
10:30:01  all    8.52    0.00    2.34    0.12    0.00    0.05    0.00    0.00    0.00   88.97
10:30:01    0    9.12    0.00    2.45    0.10    0.00    0.08    0.00    0.00    0.00   88.25
```

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

`mpstat` ‚Äî —á–∞—Å—Ç—å –ø–∞–∫–µ—Ç–∞ `sysstat`, –∫–æ—Ç–æ—Ä—ã–π —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞–µ—Ç:
- `iostat` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞
- `pidstat` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å–∞–º
- `sar` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä
- `sadf` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ñ–æ–Ω–µ, —Å–ª—É–∂–±–∞ `sysstat` —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `/etc/cron.d/sysstat`).

## Resources
##### [Configuring Flink application resources](https://docs.cloudera.com/csa/1.13.4/how-to-flink/topics/csa-other-configs.html)
