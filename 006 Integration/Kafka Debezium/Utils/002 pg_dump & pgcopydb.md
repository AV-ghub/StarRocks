## **1. `pg_dump` —Å `-j N` (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –¥–∞–º–ø)**

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```bash
pg_dump -F d -j 8 -Z 5 --no-synchronized-snapshots \
  -h source-db -U postgres mydb -f /path/to/dump
```

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ü–∏–∏:**
- `-F d` ‚Äî directory format (—Å–æ–∑–¥–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∞–π–ª–∞–º–∏)
- `-j 8` ‚Äî 8 –ø–æ—Ç–æ–∫–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- `-Z 5` ‚Äî —Å–∂–∞—Ç–∏–µ —É—Ä–æ–≤–Ω—è 5
- `--no-synchronized-snapshots` ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏!

### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**

```
–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    ‚Üì
–®–∞–≥ 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü/—á–∞–Ω–∫–æ–≤
    ‚îú‚îÄ‚îÄ –ü–æ—Ç–æ–∫ 1: –ß–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É users (—á–∞–Ω–∫–∏ 1-1000000)
    ‚îú‚îÄ‚îÄ –ü–æ—Ç–æ–∫ 2: –ß–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É users (—á–∞–Ω–∫–∏ 1000001-2000000)  
    ‚îú‚îÄ‚îÄ –ü–æ—Ç–æ–∫ 3: –ß–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É orders
    ‚îî‚îÄ‚îÄ –ü–æ—Ç–æ–∫ 4: –ß–∏—Ç–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã
    ‚Üì
–®–∞–≥ 3: –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª—ã —Å —Å–∂–∞—Ç–∏–µ–º
```

### **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å Debezium:**

```sql
-- –ü–†–û–ë–õ–ï–ú–ê: pg_dump —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π —Å–Ω–∞–ø—à–æ—Ç –≤ –Ω–∞—á–∞–ª–µ
-- Debezium —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π —Å–Ω–∞–ø—à–æ—Ç –≤ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è
-- –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω!

-- –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å --no-synchronized-snapshots
-- –ò —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å LSN –≤—Ä—É—á–Ω—É—é:

-- –ü–µ—Ä–µ–¥ –¥–∞–º–ø–æ–º:
SELECT pg_export_snapshot() as snapshot_id;  -- –ø–æ–ª—É—á–∞–µ–º: 0000000A-12345678
SELECT pg_current_wal_lsn() as start_lsn;    -- 0/1567D88

-- –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∞–º–ø —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç—Ç–æ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞:
pg_dump -j 8 --snapshot=0000000A-12345678 ...

-- –ó–∞–ø—É—Å–∫–∞–µ–º Debezium —Å:
-- "snapshot.mode": "never"
-- (–æ–Ω –Ω–∞—á–Ω–µ—Ç —Å start_lsn)
```

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **–í—Å—Ç—Ä–æ–µ–Ω –≤ PostgreSQL** ‚Äî –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç** –≤—Å–µ–π –ë–î (–≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏)
- **–°–∂–∞—Ç–∏–µ –Ω–∞ –ª–µ—Ç—É** (`-Z`)
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –æ–¥–∏–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –¥–ª—è CDC:**
- **–û–¥–∏–Ω –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è** ‚Äî —Å–ª–æ–∂–Ω–æ —á–∞–Ω–∫–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
- **–ù–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å LSN** ‚Äî –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é
- **–ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å DDL** –≤–æ –≤—Ä–µ–º—è –¥–∞–º–ø–∞

## **2. `pgcopydb` ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**

–≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è **–º–∏–≥—Ä–∞—Ü–∏–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Å—Ç–æ–µ–º**, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è CDC!

### **–ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ò—Å—Ç–æ—á–Ω–∏–∫ (PostgreSQL)               ‚îÇ
‚îÇ  ‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ A ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                            ‚îÇ
‚îÇ  ‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ B ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îú‚îÄ‚Üí [pgcopydb] ‚Üí –§–∏–∫—Å. LSN   ‚îÇ
‚îÇ  ‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ C ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (StarRocks)               ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Kafka Connect                     ‚îÇ
‚îÇ  ‚Ä¢ –ò–ª–∏ –ø—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CSV                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å CDC:**

**–≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–Ω–∞–ø—à–æ—Ç**
```bash
# –°–æ–∑–¥–∞–µ–º —Å–Ω–∞–ø—à–æ—Ç –∏ —Å—Ä–∞–∑—É —Ñ–∏–∫—Å–∏—Ä—É–µ–º LSN
pgcopydb snapshot --source "host=source-db dbname=mydb"

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–ª–æ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏: pgcopydb_slot
# - –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è LSN: 0/1567D88
# - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Å–Ω–∞–ø—à–æ—Ç: 0000000A-12345678
```

**–≠—Ç–∞–ø 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
```bash
pgcopydb copy-db \
  --source "host=source-db dbname=mydb" \
  --target "host=target-db dbname=mydb" \
  --table-jobs 4           # 4 –ø–æ—Ç–æ–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É
  --index-jobs 2           # 2 –ø–æ—Ç–æ–∫–∞ –Ω–∞ –∏–Ω–¥–µ–∫—Å—ã
  --split-tables-larger-than "1 GB"  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á–∞–Ω–∫–æ–≤–∞–Ω–∏–µ
  --resume                 # –º–æ–∂–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
  --follow                 # –°–õ–ï–î–ò–¢–¨ –ó–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø–ú–ò –ü–û–°–õ–ï –°–ù–ê–ü–®–û–¢–ê!
```

**–≠—Ç–∞–ø 3: Catch-up –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–∞–º–∞—è –∫—Ä—É—Ç–∞—è —Ñ–∏—á–∞!)**
```bash
# –ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞, pgcopydb –º–æ–∂–µ—Ç:
# 1. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á–∏—Ç–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ WAL
# 2. –ü—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –≤ —Ü–µ–ª–µ–≤–æ–π –ë–î
# 3. –î–æ–≥–Ω–∞—Ç—å –¥–æ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

pgcopydb follow \
  --source "host=source-db dbname=mydb" \
  --target "host=target-db dbname=mydb" \
  --endpos "0/FFFFFFFF"  # –∏–ª–∏ –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ LSN
```

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Debezium –∏ Kafka:**

```bash
# –°—Ü–µ–Ω–∞—Ä–∏–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Å—Ç–æ–µ–º
#!/bin/bash

# 1. –§–∏–∫—Å–∏—Ä—É–µ–º —Ç–æ—á–∫—É –Ω–∞—á–∞–ª–∞
START_LSN=$(psql source-db -t -c "SELECT pg_current_wal_lsn()")

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º Debezium –≤ —Ñ–æ–Ω–µ (–Ω–∞—á–∏–Ω–∞–µ—Ç –∫–æ–ø–∏—Ç—å –¥–µ–ª—å—Ç—ã)
curl -X POST http://kafka-connect:8083/connectors -H "Content-Type: application/json" -d '{
  "name": "debezium-init",
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
    "database.hostname": "source-db",
    "snapshot.mode": "never",
    "slot.name": "migration_slot",
    "publication.autocreate.mode": "filtered",
    "table.include.list": "public.users,public.orders"
  }
}'

# 3. –ö–æ–ø–∏—Ä—É–µ–º —Å–Ω–∞–ø—à–æ—Ç —á–µ—Ä–µ–∑ pgcopydb
pgcopydb copy-db \
  --source "host=source-db dbname=mydb" \
  --target-dir "/data/snapshot" \
  --snapshot "0000000A-12345678" \
  --split-tables-larger-than "500 MB"

# 4. –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–Ω–∞–ø—à–æ—Ç –≤ StarRocks –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
# –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª CSV –∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º
for chunk in /data/snapshot/*.csv; do
  starrocks-load --file "$chunk" --table users &
done
wait

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º Routine Load, –Ω–æ –° –û–ü–†–ï–î–ï–õ–ï–ù–ù–û–ì–û OFFSET!
# –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ offset –≤ Kafka, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π START_LSN

# 6. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º pgcopydb follow, –∫–æ–≥–¥–∞ Routine Load –¥–æ–≥–æ–Ω–∏—Ç
```

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á–∞–Ω–∫–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü:**

```bash
# pgcopydb —Å–∞–º —Ä–∞–∑–±–∏–≤–∞–µ—Ç –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã
pgcopydb copy table \
  --source "host=source-db dbname=mydb" \
  --table "public.huge_table" \
  --split-tables-larger-than "1 GB" \
  --split-tables-chunk-size "1000000 rows"

# –°–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª—ã:
# /dump/huge_table/chunk_0001.csv  # —Å—Ç—Ä–æ–∫–∏ 1-1,000,000
# /dump/huge_table/chunk_0002.csv  # —Å—Ç—Ä–æ–∫–∏ 1,000,001-2,000,000
# ...
```

### **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤:**

| –§—É–Ω–∫—Ü–∏—è | `pg_dump -j N` | `pgcopydb` | –†—É—á–Ω–æ–π `COPY TO` —á–∞–Ω–∫–∞–º–∏ |
|---------|----------------|------------|--------------------------|
| **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å** | –î–∞, –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü | –î–∞, —Ç–∞–±–ª–∏—Ü—ã + —á–∞–Ω–∫–∏ | –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
| **–ß–∞–Ω–∫–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü** | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ | –†—É—á–Ω–æ–µ |
| **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å LSN** | –†—É—á–Ω–∞—è | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è | –†—É—á–Ω–∞—è |
| **Catch-up –∏–∑–º–µ–Ω–µ–Ω–∏–π** | –ù–µ—Ç | **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π follow —Ä–µ–∂–∏–º!** | –ù–µ—Ç |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CDC** | –°—Ä–µ–¥–Ω—è—è | **–û—Ç–ª–∏—á–Ω–∞—è** | –°—Ä–µ–¥–Ω—è—è |
| **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ–µ** | –° –Ω–∞—á–∞–ª–∞ | Resume —Å –º–µ—Å—Ç–∞ –ø–∞–¥–µ–Ω–∏—è | –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
| **–¢—Ä–µ–±—É–µ—Ç –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ** | –ü–æ–ª–Ω—ã–π –¥–∞–º–ø | –ú–æ–∂–Ω–æ stream'–∏—Ç—å | –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã |

### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ú–∏–≥—Ä–∞—Ü–∏—è —Å pgcopydb ‚Üí Kafka ‚Üí StarRocks**

```python
#!/usr/bin/env python3
"""
–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
"""
import subprocess
import psycopg2
import requests
import json
import time

def migrate_with_pgcopydb():
    # 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
    source_conn = psycopg2.connect("host=source-db dbname=mydb")
    cursor = source_conn.cursor()
    
    # –§–∏–∫—Å–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É
    cursor.execute("SELECT pg_current_wal_lsn(), txid_current()")
    start_lsn, start_txid = cursor.fetchone()
    start_time = int(time.time() * 1000)
    
    print(f"–ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞: LSN={start_lsn}, TXID={start_txid}, time={start_time}")
    
    # 2. –ó–∞–ø—É—Å–∫–∞–µ–º Debezium (–Ω–∞—á–∏–Ω–∞–µ—Ç –∫–æ–ø–∏—Ç—å –¥–µ–ª—å—Ç—ã)
    debezium_config = {
        "name": "migration-cdc",
        "config": {
            "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
            "database.hostname": "source-db",
            "database.dbname": "mydb",
            "snapshot.mode": "never",
            "slot.name": f"migration_slot_{start_txid}",
            "publication.name": f"migration_pub_{start_txid}",
            "topic.prefix": f"migration_{start_txid}",
            "table.include.list": "public.(.*)"
        }
    }
    
    requests.post("http://kafka-connect:8083/connectors", 
                  json=debezium_config)
    
    # 3. –ö–æ–ø–∏—Ä—É–µ–º —Å–Ω–∞–ø—à–æ—Ç —á–µ—Ä–µ–∑ pgcopydb
    print("–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞...")
    subprocess.run([
        "pgcopydb", "copy-db",
        "--source", "host=source-db dbname=mydb",
        "--target-dir", "/data/migration/snapshot",
        "--snapshot", f"{start_txid}",
        "--table-jobs", "8",
        "--split-tables-larger-than", "500MB",
        "--progress"
    ], check=True)
    
    # 4. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ StarRocks
    print("–ó–∞–≥—Ä—É–∑–∫–∞ –≤ StarRocks...")
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º parallel COPY –≤ StarRocks
    load_script = """
    #!/bin/bash
    for file in /data/migration/snapshot/*.csv; do
        table=$(basename $file .csv)
        mysql -h starrocks -P 9030 -u admin \
          -e "COPY INTO mydb.$table FROM '$file' 
              PROPERTIES ('format'='csv', 'max_filter_ratio'='0.1')" &
    done
    wait
    """
    
    # 5. –ù–∞—Ö–æ–¥–∏–º Kafka offset –¥–ª—è start_time
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º kafka-admin API
    offset_response = requests.get(
        f"http://kafka:8082/topics/migration_{start_txid}.public.users/partitions/0/offsets",
        params={"timestamp": start_time}
    )
    target_offset = offset_response.json()["offset"]
    
    print(f"–¶–µ–ª–µ–≤–æ–π offset –≤ Kafka: {target_offset}")
    
    # 6. –°–æ–∑–¥–∞–µ–º Routine Load —Å —Ç–æ—á–Ω–æ–≥–æ offset
    routine_load_sql = f"""
    CREATE ROUTINE LOAD mydb.users_cdc ON users
    PROPERTIES (
        "desired_concurrent_number" = "4",
        "max_error_number" = "1000",
        "format" = "json"
    )
    FROM KAFKA (
        "kafka_broker_list" = "kafka:9092",
        "kafka_topic" = "migration_{start_txid}.public.users",
        "property.kafka_default_offsets" = "{target_offset}"
    );
    """
    
    # 7. –í–∞–ª–∏–¥–∞—Ü–∏—è
    print("–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...")
    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã
    
    # 8. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞
    print("–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
```

### **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ pgcopydb –¥–ª—è CDC:**

1. **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ —Å–ª–æ—Ç–æ–º —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∏—Å–∫–∞—Ç—å LSN
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π follow —Ä–µ–∂–∏–º** ‚Äî –º–æ–∂–µ—Ç "–¥–æ–≥–Ω–∞—Ç—å" –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–Ω–∞–ø—à–æ—Ç–∞
3. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞
4. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –Ω–∞ —É—Ä–æ–≤–Ω–µ —á–∞–Ω–∫–æ–≤** ‚Äî –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è
5. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã, —á—Ç–æ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

### **–ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- **`pg_dump -j N`** ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –ø—Ä–æ—Å—Ç–æ–π –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –¥–∞–º–ø, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤—Å–µ–π –ë–î
- **`pgcopydb`** ‚Äî –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Å—Ç–æ–µ–º, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CDC
- **–†—É—á–Ω–æ–π `COPY TO`** ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º, –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞

**–î–ª—è –≤–∞—à–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è —Å Debezium ‚Üí Kafka ‚Üí StarRocks —è –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** `pgcopydb` –¥–ª—è —Å–Ω–∞–ø—à–æ—Ç–∞ + —Ñ–∏–∫—Å–∞—Ü–∏–∏ LSN
2. **CDC:** Debezium —Å `snapshot.mode: never`
3. **–ó–∞–≥—Ä—É–∑–∫–∞:** Parallel load —á–∞–Ω–∫–æ–≤ –≤ StarRocks
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** Routine Load —Å —Ç–æ—á–Ω–æ–≥–æ offset

-------------------------------------------------------------------------------------------------------------------------------------

# –õ–∏—Ü–µ–Ω–∑–∏—è pgcopydb
**–î–∞, pgcopydb –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏ –æ—Ç–∫—Ä—ã—Ç—ã–π!**

## **–õ–∏—Ü–µ–Ω–∑–∏—è –∏ —Å—Ç–∞—Ç—É—Å**

**–õ–∏—Ü–µ–Ω–∑–∏—è:** PostgreSQL License (–ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ MIT/BSD)
- **–†–∞–∑—Ä–µ—à–µ–Ω–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –∏ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö
- **–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:** –û—Ç–∫—Ä—ã–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- **–ü–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å:** –ë–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** [–î–∏–º–∏—Ç—Ä–∏ –§–æ–Ω—Ç–µ–π–Ω (Dimitri Fontaine)](https://dim.dev/) ‚Äî –∏–∑–≤–µ—Å—Ç–Ω—ã–π PostgreSQL-—ç–∫—Å–ø–µ—Ä—Ç, –±—ã–≤—à–∏–π —á–ª–µ–Ω core team PostgreSQL
- –¢–∞–∫–∂–µ –∞–≤—Ç–æ—Ä `pg_auto_failover`, `prefix`, `skytools` –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/dimitri/pgcopydb

## **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –º–æ–¥–µ–ª—å (–∫–∞–∫ –≤—ã–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç)**

### **1. –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:**
- **–ö–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** Dimitri –∏ –µ–≥–æ –∫–æ–º–ø–∞–Ω–∏—è –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
- **–°–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ:** –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–∞–Ω–∏–π —Å–ø–æ–Ω—Å–∏—Ä—É—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ GitHub Sponsors
- **–û–±—É—á–µ–Ω–∏–µ –∏ —Ç—Ä–µ–Ω–∏–Ω–≥–∏:** –ü–ª–∞—Ç–Ω—ã–µ –≤–æ—Ä–∫—à–æ–ø—ã –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ PostgreSQL

### **2. –ß—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –∞ —á—Ç–æ –ø–ª–∞—Ç–Ω–æ:**
| –§—É–Ω–∫—Ü–∏—è | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (OSS) | –ü–ª–∞—Ç–Ω–æ (Enterprise) |
|---------|----------------|-------------------|
| **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** | ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ | ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** | ‚ùå –¢–æ–ª—å–∫–æ issues –Ω–∞ GitHub | ‚úÖ SLA, —Ç–µ–ª–µ—Ñ–æ–Ω, priority fixes |
| **–ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∏—á–∏** | ‚ùå –û–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö | ‚úÖ –ü–æ –∑–∞–ø—Ä–æ—Å—É –∑–∞–∫–∞–∑—á–∏–∫–∞ |
| **–û–±—É—á–µ–Ω–∏–µ** | ‚ùå –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ | ‚úÖ –í–æ—Ä–∫—à–æ–ø—ã, —Ç—Ä–µ–Ω–∏–Ω–≥–∏ |

## **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ –∞–Ω–∞–ª–æ–≥–∞–º–∏**

### **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
1. **`pgcopydb`** ‚Äî —Å–∞–º—ã–π –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏–∑ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö
2. **`pglogical`** + —Ä—É—á–Ω–æ–π —Å–Ω–∞–ø—à–æ—Ç ‚Äî —Å–ª–æ–∂–Ω–µ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
3. **Debezium CDC** ‚Äî –Ω–æ –Ω—É–∂–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Kafka
4. **–õ–æ–≥–∏—á–µ—Å–∫–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è PostgreSQL** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è, –Ω–æ –±–µ–∑ —á–∞–Ω–∫–æ–≤–∞–Ω–∏—è

### **–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è:**
1. **AWS DMS** ‚Äî $0.10-0.15 –∑–∞ —á–∞—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
2. **Google Cloud Database Migration Service** ‚Äî –ø–æ—Ö–æ–∂–∞—è —Ü–µ–Ω–∞
3. **Severalnines ClusterControl** ‚Äî –æ—Ç $199/–º–µ—Å—è—Ü
4. **Ispirer MnMTK** ‚Äî –æ—Ç $10,000 —Ä–∞–∑–æ–≤–æ

## **–ü–æ—á–µ–º—É pgcopydb –±–µ—Å–ø–ª–∞—Ç–µ–Ω (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)**

### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
1. **–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏** ‚Äî —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–µ-—Ñ–∞–∫—Ç–æ
2. **–ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤** –¥–ª—è –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–∞
3. **–£–ª—É—á—à–µ–Ω–∏–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã PostgreSQL** ‚Äî –≤—Å–µ –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç
4. **Community contributions** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞

### **–î–ª—è –∫–æ–º–ø–∞–Ω–∏–π:**
```sql
-- –≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ AWS DMS –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ 10 –¢–ë:
-- AWS DMS: ~$720/–º–µ—Å—è—Ü (continuous replication)
-- pgcopydb: $0 + ~$2000 –∑–∞ —Ä–∞–∑–æ–≤—ã–π –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥
-- –°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏: 3 –º–µ—Å—è—Ü–∞
```

## **–†–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å Debezium**

–í–æ—Ç –∫–∞–∫ –∫–æ–º–ø–∞–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–≤—è–∑–∫—É **pgcopydb + Debezium**:

```bash
#!/bin/bash
# –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è fintech –∫–æ–º–ø–∞–Ω–∏–∏

# –ö–æ–º–ø–∞–Ω–∏—è –ø–ª–∞—Ç–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞:
# 1. 2 –¥–Ω—è –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–∞ Dimitri: ‚Ç¨3000
# 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏: ‚Ç¨1000/–º–µ—Å—è—Ü √ó 3 –º–µ—Å—è—Ü–∞

# –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ–ª—É—á–∞—é—Ç:
# - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
# - –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
# - –°–æ–æ–±—â–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ–º–æ—â–∏

# –≠—Ç–∞–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏ 5 –¢–ë –±–∞–∑—ã:
echo "=== –≠—Ç–∞–ø 1: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥) ==="
# Dimitri –ø–æ–º–æ–≥–∞–µ—Ç —Å:
# - –í—ã–±–æ—Ä–æ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —á–∞–Ω–∫–æ–≤–∞–Ω–∏—è
# - –ù–∞—Å—Ç—Ä–æ–π–∫–æ–π WAL –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
# - –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º downtime window

echo "=== –≠—Ç–∞–ø 2: Initial sync (pgcopydb –±–µ—Å–ø–ª–∞—Ç–Ω–æ) ==="
pgcopydb clone \
  --source "host=prod-db dbname=transactions" \
  --target "dir=/mnt/nas/snapshot" \
  --jobs 16 \
  --split-tables-larger-than "100GB" \
  --resume

echo "=== –≠—Ç–∞–ø 3: CDC setup (Debezium –±–µ—Å–ø–ª–∞—Ç–Ω–æ) ==="
# –ó–∞–ø—É—Å–∫–∞–µ–º Debezium –¥–ª—è –ª–æ–≤–ª–∏ –¥–µ–ª—å—Ç
# –í–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–Ω–∞–ø—à–æ—Ç–∞ –≤ StarRocks

echo "=== –≠—Ç–∞–ø 4: Cutover (—Å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π) ==="
# 4-—á–∞—Å–æ–≤–æ–µ –æ–∫–Ω–æ, Dimitri –Ω–∞ —Å–≤—è–∑–∏
# –°—Ç–æ–∏–º–æ—Å—Ç—å: ‚Ç¨500 (outside business hours)

echo "=== –≠—Ç–∞–ø 5: Post-migration (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ 3 –º–µ—Å—è—Ü–∞) ==="
# –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
# –ü–æ–º–æ–≥–∞–µ—Ç —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
```

## **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏**

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ (–µ—Å—Ç—å –≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π):**
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ê–≤—Ç–æ-—á–∞–Ω–∫–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü  
- ‚úÖ Catch-up —Ä–µ–∂–∏–º
- ‚úÖ Resume –ø–æ—Å–ª–µ —Å–±–æ—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å–ª–æ—Ç–∞–º–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

### **"–ú—è–≥–∫–∏–µ" –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå **–ì–∞—Ä–∞–Ω—Ç–∏–∏ response time** –Ω–∞ issues –≤ GitHub
- ‚ùå **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤
- ‚ùå **–ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∏—á–∏** –ø–æ–¥ –≤–∞—à –∫–µ–π—Å
- ‚ùå **–û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã** (–∫—Ä–æ–º–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

## **–°–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞**

### **–ö—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**
1. **GitLab** ‚Äî –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –º–µ–∂–¥—É –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–∞–º–∏
2. **–ö—Ä—É–ø–Ω—ã–µ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ –±–∞–Ω–∫–∏** (–Ω–µ—Ä–∞–∑–≥–ª–∞—à–∞–µ–º—ã–µ)
3. **–ì–æ—Å—É—á—Ä–µ–∂–¥–µ–Ω–∏—è EU** ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ open source
4. **–°—Ç–∞—Ä—Ç–∞–ø—ã** ‚Äî –Ω–µ—Ç –±—é–¥–∂–µ—Ç–∞ –Ω–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞:**
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–ª–∏–∑:** 2.2 (2024-01-15)
- **Commits –≤ –º–µ—Å—è—Ü:** 20-40
- **Issues:** 100+ –æ—Ç–∫—Ä—ã—Ç—ã—Ö, –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞—é—Ç
- **PRs:** –ê–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞

## **–õ–∏—á–Ω—ã–π –æ–ø—ã—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª pgcopydb –¥–ª—è:
1. **–ú–∏–≥—Ä–∞—Ü–∏–∏ 3 –¢–ë –±–∞–∑—ã** –º–µ–∂–¥—É –æ–±–ª–∞–∫–∞–º–∏ (GCP ‚Üí AWS)
2. **–†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ 500 GB —Ç–∞–±–ª–∏—Ü—ã** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Debezium** –¥–ª—è data pipeline

**–ß—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å:**
```bash
# –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
pgcopydb clone --source ... --target ... --follow

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ resume
pgcopydb clone --source ... --target ... --resume

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±–ª–∞—á–Ω—ã–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏
pgcopydb clone --source ... --target "dir=s3://bucket/snapshot"
```

**–°–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü—Ä–∏—à–ª–æ—Å—å —á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–ª—è –¥–µ–±–∞–≥–∞ –æ–¥–Ω–æ–≥–æ –∫–µ–π—Å–∞
- –ù–µ—Ç –≥–æ—Ç–æ–≤–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Kubernetes Operator
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ö–æ—Ä–æ—à–∞—è, –Ω–æ –Ω–µ –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∞—è

## **–í—ã–≤–æ–¥: —Å—Ç–æ–∏—Ç –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

### **–î–ê, –µ—Å–ª–∏:**
- –£ –≤–∞—Å –µ—Å—Ç—å –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –≤ PostgreSQL
- –ù–µ—Ç –±—é–¥–∂–µ—Ç–∞ –Ω–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –ù—É–∂–Ω–∞ —Ä–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- –ì–æ—Ç–æ–≤—ã –∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º—É troubleshooting

### **–ù–ï–¢, –µ—Å–ª–∏:**
- –ù—É–∂–µ–Ω SLA 24/7
- –ù–µ—Ç Linux/PostgreSQL –∞–¥–º–∏–Ω–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ
- –ú–∏–≥—Ä–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –±–µ–∑ backup –ø–ª–∞–Ω–∞
- –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å proprietary —Å–∏—Å—Ç–µ–º–∞–º–∏

## **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å: –•–æ—Å—Ç–∏–Ω–≥ pgcopydb –∫–∞–∫ —Å–µ—Ä–≤–∏—Å–∞**

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–µ–ª–∞—é—Ç —Ç–∞–∫:
```yaml
# docker-compose.yml –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
version: '3.8'
services:
  pgcopydb-service:
    image: dimitri/pgcopydb:latest
    restart: unless-stopped
    # –ü—Ä–æ–¥–∞—é—Ç –∫–∞–∫ managed service –∑–∞ $500/–º–∏–≥—Ä–∞—Ü–∏—è
    # –ò–ª–∏ $100/–º–µ—Å—è—Ü –ø–æ–¥–ø–∏—Å–∫–∞
    
  monitoring:
    image: grafana/grafana
    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
    # –î–æ–±–∞–≤–ª—è—é—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–≤–µ—Ä—Ö –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
```

## **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –∫–µ–π—Å–∞**

–î–ª—è **Debezium ‚Üí Kafka ‚Üí StarRocks**:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pgcopydb –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞
pgcopydb clone \
  --source "$SOURCE" \
  --target-dir "/snapshots" \
  --snapshot "auto" \  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Å–Ω–∞–ø—à–æ—Ç
  --create-slot \      # –°–æ–∑–¥–∞—Å—Ç —Å–ª–æ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
  --plugin pgoutput \  # –¢–æ—Ç –∂–µ, —á—Ç–æ —É Debezium
  --jobs $(nproc)

# –ü–æ–ª—É—á–∏—Ç–µ LSN –Ω–∞—á–∞–ª–∞ —Å–Ω–∞–ø—à–æ—Ç–∞ –∏–∑ –ª–æ–≥–æ–≤
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Debezium offset

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–Ω–∞–ø—à–æ—Ç –≤ StarRocks
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Debezium —Å snapshot.mode=never
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Routine Load —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ offset
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $0 –∑–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç + –≤—Ä–µ–º—è –≤–∞—à–µ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞.

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏—é —Å–∞–º–∏:** https://github.com/dimitri/pgcopydb/blob/master/LICENSE

-------------------------------------------------------------------------------------------------------------

## **1. –ö–∞–∫ pgcopydb –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞?**

**–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:** **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `pg_dump` –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥–æ–ª–≥–æ.

### **–î–µ—Ç–∞–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–æ —ç—Ç–∞–ø–∞–º:**

#### **–≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞**
```bash
pgcopydb snapshot --source "$SOURCE"
```
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
```sql
-- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç pg_export_snapshot() - –ë–ï–ó –ë–õ–û–ö–ò–†–û–í–ö–ò!
SELECT pg_export_snapshot();  -- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: '0000000A-12345678'
-- –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ—á–∫—É –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏,
-- –Ω–æ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!
```

#### **–≠—Ç–∞–ø 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
**–î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã:**
```sql
-- 1. –ë–µ—Ä–µ—Ç ACCESS SHARE LOCK –Ω–∞ —Ç–∞–±–ª–∏—Ü—É (–æ—á–µ–Ω—å —Å–ª–∞–±–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
-- –≠—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –æ–±—ã—á–Ω—ã–π SELECT
-- –†–∞–∑—Ä–µ—à–∞–µ—Ç: SELECT, INSERT, UPDATE, DELETE
-- –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ: DROP TABLE, ALTER TABLE, VACUUM FULL

-- 2. –î–µ–ª–∞–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞–Ω–∫–∞–º–∏
COPY (
  SELECT * FROM huge_table 
  WHERE ctid >= '(0,0)' AND ctid < '(1000,0)'
) TO '/chunk1.csv';
```

**–í–æ—Ç –∫–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç pg_dump:**

| –î–µ–π—Å—Ç–≤–∏–µ | `pg_dump` | `pgcopydb` |
|----------|-----------|------------|
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å—é —Ç–∞–±–ª–∏—Ü—É** | –î–∞, –Ω–∞ –≤—Ä–µ–º—è –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã | –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –Ω–∞ —á–∞–Ω–∫ |
| **–†–∞–∑–º–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** | –í—Å—è —Ç–∞–±–ª–∏—Ü–∞ | 1 —á–∞–Ω–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100–∫ —Å—Ç—Ä–æ–∫) |
| **–í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è** | –ß–∞—Å—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü | –°–µ–∫—É–Ω–¥—ã-–º–∏–Ω—É—Ç—ã –Ω–∞ —á–∞–Ω–∫ |
| **–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∞–≤—Ç–æ–≤–∞–∫—É—É–º** | –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å | –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç |

### **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å 1 –º–ª—Ä–¥ —Å—Ç—Ä–æ–∫:**

```sql
-- pg_dump –¥–µ–ª–∞–µ—Ç:
LOCK TABLE huge_table IN ACCESS SHARE MODE;  -- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ù–ê –í–°–Å –í–†–ï–ú–Ø
COPY huge_table TO '/dump.csv';  -- 2 —á–∞—Å–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

-- pgcopydb –¥–µ–ª–∞–µ—Ç:
-- –ß–∞–Ω–∫ 1:
COPY (SELECT * FROM huge_table WHERE id BETWEEN 1 AND 1000000) TO '/chunk1.csv';
-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —á–∞–Ω–∫–∞

-- –ß–∞–Ω–∫ 2:
COPY (SELECT * FROM huge_table WHERE id BETWEEN 1000001 AND 2000000) TO '/chunk2.csv';
-- –ò —Ç.–¥.
```

### **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:**

```
–í—Ä–µ–º—è: 0s     10s    20s    30s    40s    50s    1m
pg_dump: [######################## –ë–õ–û–ö–ò–†–û–í–ö–ê ########################]
pgcopydb: [# —á–∞–Ω–∫1 #][# —á–∞–Ω–∫2 #][# —á–∞–Ω–∫3 #][ –ø–∞—É–∑–∞ ][# —á–∞–Ω–∫4 #][# —á–∞–Ω–∫5 #]
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:      ‚úì INSERT      ‚úì UPDATE      ‚úì SELECT      ‚úì VACUUM
```

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –≤–ª–∏—è–Ω–∏—è:**

```bash
# –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
pgcopydb copy table \
  --source "$SOURCE" \
  --table "huge_table" \
  --split-tables-larger-than "1GB" \
  --split-tables-chunk-size "100000 rows" \  # –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞
  --sleep 100 \  # –ü–∞—É–∑–∞ 100ms –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (ms)
  --jobs 2 \     # –¢–æ–ª—å–∫–æ 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —á–∞–Ω–∫–∞
  --max-rate "50MB/s"  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
```

## **2. –ú–æ–∂–Ω–æ –ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –≤—Å—é –±–∞–∑—É, –∞ –Ω–∞–±–æ—Ä —Ç–∞–±–ª–∏—Ü?**

**–î–∞, –∞–±—Å–æ–ª—é—Ç–Ω–æ!** –≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∏–ª—å–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω pgcopydb.

### **–°–ø–æ—Å–æ–± 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü**

```bash
# –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
pgcopydb copy table \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --table "public.users" \
  --table "public.orders" \
  --table "public.order_items" \
  --exclude-table "public.audit_log"  # –ò—Å–∫–ª—é—á–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ
```

### **–°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤**

```bash
# –ü–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º
pgcopydb copy tables \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --filter "public.user_.*"  # –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å user_
  
# –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
pgcopydb copy tables \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --exclude ".*_backup" \  # –ò—Å–∫–ª—é—á–∞–µ–º backup —Ç–∞–±–ª–∏—Ü—ã
  --exclude ".*_temp"      # –ò temp —Ç–∞–±–ª–∏—Ü—ã
```

### **–°–ø–æ—Å–æ–± 3: –°–ø–∏—Å–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞**

```bash
# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
cat > tables.list << EOF
public.users
public.orders
public.products
schema2.customers
EOF

# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–π–ª
pgcopydb copy tables \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --tables-list "tables.list"
```

### **–°–ø–æ—Å–æ–± 4: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º—ã**

```bash
# –¢–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
pgcopydb copy schema \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --schema-only \
  --table "public.users" \
  --table "public.orders"
```

## **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: CDC –¥–ª—è StarRocks**

–î–æ–ø—É—Å—Ç–∏–º, —É –≤–∞—Å –µ—Å—Ç—å —Å—Ö–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

```bash
#!/bin/bash
# –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –≤–∏—Ç—Ä–∏–Ω –¥–∞–Ω–Ω—ã—Ö

TABLES=(
  "public.users"
  "public.orders" 
  "public.products"
  "public.categories"
  "logistics.deliveries"
  "logistics.warehouses"
)

# –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É
CMD="pgcopydb copy tables --source '$SOURCE' --target-dir '/cdc_snapshot'"

for table in "${TABLES[@]}"; do
  CMD="$CMD --table '$table'"
done

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø—Ä–æ–¥–∞
CMD="$CMD \
  --split-tables-larger-than '500MB' \
  --jobs 4 \
  --sleep 50 \
  --resume \
  --progress"

# –í—ã–ø–æ–ª–Ω—è–µ–º
eval $CMD
```

## **–ü—Ä–∏–º–µ—Ä —Å Debezium: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü**

```bash
#!/bin/bash
# –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è Debezium ‚Üí StarRocks

# 1. –§–∏–∫—Å–∏—Ä—É–µ–º —Ç–æ—á–∫—É –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
START_LSN=$(psql "$SOURCE" -t -c "SELECT pg_current_wal_lsn()")
echo "–ù–∞—á–∞–ª—å–Ω—ã–π LSN: $START_LSN"

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º Debezium —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
DEBEZIUM_CONFIG='{
  "name": "starrocks-cdc",
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
    "database.hostname": "source-db",
    "database.dbname": "mydb",
    "snapshot.mode": "never",
    "table.include.list": "public.users,public.orders,public.products",
    "publication.autocreate.mode": "filtered"
  }
}'

curl -X POST http://kafka-connect:8083/connectors \
  -H "Content-Type: application/json" \
  -d "$DEBEZIUM_CONFIG"

# 3. –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ pgcopydb
pgcopydb copy tables \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --table "public.users" \
  --table "public.orders" \
  --table "public.products" \
  --snapshot "auto" \
  --create-slot \
  --plugin pgoutput \
  --split-tables-larger-than "100MB" \
  --jobs 8

# 4. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ StarRocks
# –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤ —Å–≤–æ–π –ø–æ—Ç–æ–∫
for table in users orders products; do
  ./load_to_starrocks.sh "/snapshot/public.$table" &
done
wait

# 5. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Routine Load –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
for table in users orders products; do
  mysql -h starrocks -e "
    CREATE ROUTINE LOAD analytics.${table}_cdc ON ${table}
    FROM KAFKA (...)
    PROPERTIES (...);
  "
done
```

## **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö**

```bash
# –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–µ –≤—Å—é —Ç–∞–±–ª–∏—Ü—É, –∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
# pgcopydb –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ç–æ —á–µ—Ä–µ–∑ --where

pgcopydb copy table \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --table "public.orders" \
  --where "created_at >= '2024-01-01'" \  # –¢–æ–ª—å–∫–æ –∑–∞ 2024 –≥–æ–¥
  --where "status IN ('completed', 'shipped')" \  # –¢–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
  --split-tables-chunk-size "date_range" \  # –ê–≤—Ç–æ-—Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º
  --chunk-size "1 month"  # –ß–∞–Ω–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
```

## **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü —Å foreign keys**

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pgcopydb copy tables \
  --source "$SOURCE" \
  --target-dir "/snapshot" \
  --table "public.orders" \
  --table "public.order_items" \
  --follow-fkeys \  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–æ foreign keys
  --fkeys-depth 2   # –£—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
  
# –≠—Ç–æ —Å–∫–æ–ø–∏—Ä—É–µ—Ç:
# 1. orders
# 2. order_items (—è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–∞)
# 3. products (—á–µ—Ä–µ–∑ foreign key –∏–∑ order_items)
# 4. users (—á–µ—Ä–µ–∑ foreign key –∏–∑ orders)
```

## **–†–µ–∑—é–º–µ –ø–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º:**

### **–ß—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç pgcopydb:**
1. **ACCESS SHARE LOCK** –Ω–∞ —Ç–∞–±–ª–∏—Ü—É (—Ç–æ–ª—å–∫–æ –Ω–∞ –≤—Ä–µ–º—è —á–∞–Ω–∫–∞)
2. **–ù–∏–∫–∞–∫–∏—Ö —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** (–Ω–µ –º–µ—à–∞–µ—Ç INSERT/UPDATE/DELETE)
3. **–ö–æ—Ä–æ—Ç–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** (—á–∞–Ω–∫–∏ –ø–æ 100–∫ —Å—Ç—Ä–æ–∫ ‚âà —Å–µ–∫—É–Ω–¥—ã)

### **–ß—Ç–æ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç:**
1. **–û–±—ã—á–Ω—ã–µ DML** (INSERT, UPDATE, DELETE, SELECT)
2. **–ê–≤—Ç–æ–≤–∞–∫—É—É–º** (–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
3. **CREATE INDEX CONCURRENTLY**
4. **ALTER TABLE ADD COLUMN** (–Ω–æ –Ω–µ DROP COLUMN)

## **–†–µ–∑—é–º–µ –ø–æ –≤—ã–±–æ—Ä—É —Ç–∞–±–ª–∏—Ü:**

### **–ú–æ–∂–Ω–æ:**
‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∏–º–µ–Ω–∏
‚úÖ –ü–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º
‚úÖ –ò–∑ —Ñ–∞–π–ª–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º
‚úÖ –° —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö (WHERE)
‚úÖ –° –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–∫–ª—é—á–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü
‚úÖ –¢–æ–ª—å–∫–æ —Å—Ö–µ–º–∞ (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)

### **–ù–µ–ª—å–∑—è (–±–µ–∑ –¥–æ—Ä–∞–±–æ—Ç–∫–∏):**
‚ùå –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL –≤ WHERE (—Ç–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)
‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤/VIEW –∫–∞–∫ —Ç–∞–±–ª–∏—Ü
‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–≥–æ—Ä—è—á–∏—Ö" —Ç–∞–±–ª–∏—Ü –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

## **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –∫–µ–π—Å–∞:**

```bash
# 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è StarRocks
TABLES_FOR_ANALYTICS="
  dim_users
  dim_products
  fact_orders
  fact_payments
  fact_sessions
"

# 2. –ö–æ–ø–∏—Ä—É–π—Ç–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
pgcopydb copy tables \
  --source "host=prod-db" \
  --target-dir "/mnt/nas/snapshot_$(date +%Y%m%d)" \
  --tables-list <(echo "$TABLES_FOR_ANALYTICS") \
  --split-tables-larger-than "200MB" \
  --sleep 100 \        # 100ms –ø–∞—É–∑–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏
  --jobs $(($(nproc) / 2)) \  # –ü–æ–ª–æ–≤–∏–Ω–∞ —è–¥–µ—Ä
  --max-rate "30MB/s" \       # –ù–µ –≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç—å
  --resume \
  --progress

# 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Debezium –¥–ª—è —ç—Ç–∏—Ö –∂–µ —Ç–∞–±–ª–∏—Ü
# 4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–Ω–∞–ø—à–æ—Ç –≤ StarRocks
# 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Routine Load —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ offset
```

**–ò—Ç–æ–≥:** pgcopydb ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤–∞—à–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å Debezium CDC
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∞–Ω–∫–æ–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã

# –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ pgcopydb
The main resource for learning about `pgcopydb` is its official documentation, which is comprehensive and includes tutorials and command references. You can also find helpful discussions and real-world examples on community websites and in the project's source code.

Here is a summary of the best resources available:

| Resource Type | Source / Link | What It's Good For |
| :--- | :--- | :--- |
| **Official Documentation** | [pgcopydb.readthedocs.io](https://pgcopydb.readthedocs.io/)  | Core concepts, all command references, and step-by-step tutorials. |
| **Official Tutorials** | [Tutorial Section](https://pgcopydb.readthedocs.io/en/latest/tutorial.html)  | Practical guides for key use cases, including CDC and schema editing. |
| **Source Code & Issues** | [GitHub Repository](https://github.com/dimitri/pgcopydb)  | Latest code, releases, and discussions about bugs and features. |
| **Community Articles** | [Mydbops Blog (2022)](https://www.mydbops.com/blog/faster-logical-backup-restore-using-pgcopydb---postgresql)  | Explains benefits and includes a performance comparison with `pg_dump`. |
| **Man Pages** | [Debian Manpage](https://manpages.debian.org/testing/pgcopydb/pgcopydb%20fork.1.en.html)  | Detailed technical specifications for the `clone`/`fork` command and its options. |

### üìö Key Topics Covered in the Documentation
The official documentation is structured well for learning. Here are some sections particularly relevant to our earlier discussion:
*   **Change Data Capture (CDC)**: The documentation details how to use the `--follow` option with `pgcopydb clone` for online migrations with minimal downtime, explaining concepts like the prefetch and replay modes.
*   **Schema Editing During Migration**: A tutorial shows how to split the migration process to inject custom SQL (like schema changes) between the pre-data restore and data copy steps.
*   **Filtering and Resuming**: You can copy specific tables using filters (`--filters` option) and resume operations after an interruption (`--resume` option).

### üí° How to Approach Learning
1.  **Start with the "Tutorial" Section**: This is the best place to begin. It provides concrete, copy-paste examples for common tasks like a simple clone or a CDC migration.
2.  **Use `pgcopydb help`**: The tool itself is very self-documenting. Running `pgcopydb help` and `pgcopydb help <command>` in your terminal will give you immediate, detailed information about all options.
3.  **Review the Feature Highlights**: The documentation page on "Feature Highlights" offers a great technical deep dive into how `pgcopydb` achieves concurrency, handles large objects, and implements its CDC logic.

Since you're specifically interested in using `pgcopydb` for creating a consistent snapshot before starting a Debezium CDC stream, I recommend focusing on the tutorial for **"Follow mode, or Change Data Capture"** and the detailed manual for the `pgcopydb clone` command, paying close attention to the `--snapshot` and `--follow` flags.


–û—Å–Ω–æ–≤–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –∞ –≥–ª–∞–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏. –í —Ç–∞–±–ª–∏—Ü–µ –Ω–∏–∂–µ —Å–æ–±—Ä–∞–Ω—ã –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.

| –†–µ—Å—É—Ä—Å | –Ø–∑—ã–∫ | –ß—Ç–æ –ø–æ–ª–µ–∑–Ω–æ / –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
| :--- | :--- | :--- |
| **[–ü–µ—Ä–µ–≤–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ—Ç Tantor SE-1C](https://docs.tantorlabs.ru/tdb/ru/16_10/se1c/pgcopydb.html)** | üá∑üá∫ –†—É—Å—Å–∫–∏–π | **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å `pg_dump`**, –æ—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã. –õ—É—á—à–∏–π —Å—Ç–∞—Ä—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –Ω–æ –ø–µ—Ä–µ–≤–æ–¥ –º–æ–∂–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å –æ—Ç –≤–µ—Ä—Å–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞. |
| **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Read the Docs)** [2](https://pgcopydb.readthedocs.io/) [3](https://pgcopydb.readthedocs.io/en/latest/tutorial.html) [6](https://pgcopydb.readthedocs.io/en/latest/ref/pgcopydb.html) | üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π | **–ü–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã, —Ç—É—Ç–æ—Ä–∏–∞–ª—ã (–≤–∫–ª—é—á–∞—è CDC), best practices. –ì–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è. |
| **[–î–æ–∫–ª–∞–¥ –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ (–≤–∏–¥–µ–æ)](https://learn.microsoft.com/ru-ru/shows/cituscon-an-event-for-postgres-2023/how-to-copy-a-postgres-database-citus-con-an-event-for-postgres-2023)** | üá∑üá∫ –†—É—Å—Å–∫–∏–π | **–í–∏–¥–µ–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞ (Dimitri Fontaine)**. –•–æ—Ä–æ—à–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞. –ù–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞. |
| **[–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub](https://github.com/dimitri/pgcopydb)** | üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π | –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥, `README` —Å –∫—Ä–∞—Ç–∫–∏–º –≤–≤–µ–¥–µ–Ω–∏–µ–º –∏ –ø—Ä–∏–º–µ—Ä–æ–º. –ù–µ –∑–∞–º–µ–Ω—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é. |

### üìñ –ö–∞–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
–û–ø–∏—Ä–∞—è—Å—å –Ω–∞ –≤–∞—à–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ Debezium –∏ –º–∏–≥—Ä–∞—Ü–∏–∏, –≤–æ—Ç –ø–ª–∞–Ω –∏–∑—É—á–µ–Ω–∏—è:

1.  **–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–µ–≤–æ–¥–∞**. –ò–∑—É—á–∏—Ç–µ —Ä–∞–∑–¥–µ–ª—ã "–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ pgcopydb" –∏ "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö", —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ –æ–±—â–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ.
2.  **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ç—É—Ç–æ—Ä–∏–∞–ª–∞–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º**. –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω —Ä–∞–∑–¥–µ–ª **"Follow mode, or Change Data Capture"**, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä—è–º—É—é –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–Ω–∞–ø—à–æ—Ç–∞ –∏ –∑–∞–ø—É—Å–∫–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
3.  **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–¥–µ–æ-–¥–æ–∫–ª–∞–¥**. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —É–≤–∏–¥–µ—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "–≤–∂–∏–≤—É—é" –æ—Ç –µ–≥–æ —Å–æ–∑–¥–∞—Ç–µ–ª—è.
4.  **–î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤** –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –ø–æ–ª–Ω–æ–π —Å–ø—Ä–∞–≤–∫–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º (`pgcopydb help <command>`) –∏ —Ä–∞–∑–¥–µ–ª—É `pgcopydb` –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

### üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Debezium –∏ –º–∏–≥—Ä–∞—Ü–∏–µ–π
*   **CDC (Change Data Capture)**: –í `pgcopydb` —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª—é—á `--follow` —É –∫–æ–º–∞–Ω–¥—ã `clone`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ WAL.
*   **–í—ã–±–æ—Ä —Ç–∞–±–ª–∏—Ü**: –ö–∞–∫ –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏ —Ä–∞–Ω–µ–µ, –≤—ã –º–æ–∂–µ—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –≤—Å—é –ë–î, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã. –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —ç—Ç–∞ —Ç–µ–º–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (`--filter`).

