# [Colocate Table](https://docs.starrocks.io/docs/best_practices/query_tuning/schema_tuning/#colocate-table)
```
–ø–æ–¥—Å–∫–∞–∂–∏ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ—Ç —Ç—É—Ç https://docs.starrocks.io/docs/best_practices/query_tuning/schema_tuning/#colocate-table
—á—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –ø–æ–¥ common bucketing column?
–º–æ–∂–Ω–æ –Ω–∞–≥–ª—è–¥–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤ –∏—Ç–æ–≥–µ —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ Colocate join?
```
–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü –¥–ª—è Colocate Join –≤ StarRocks, –≥–¥–µ `user_id` —è–≤–ª—è–µ—Ç—Å—è `common bucketing column`:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã (–æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –≤ –≥—Ä—É–ø–ø–µ 'user_group')
CREATE TABLE user_actions (
    user_id INT,
    action_time DATETIME,
    action_type VARCHAR(20),
    item_id INT
)
DISTRIBUTED BY HASH(user_id) BUCKETS 8  -- –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ user_id, 8 –±–∞–∫–µ—Ç–æ–≤
PROPERTIES (
    "colocate_with" = "user_group",      -- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã
    "replication_num" = "3"
);

-- –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø–µ
CREATE TABLE user_profiles (
    user_id INT,
    user_name VARCHAR(50),
    age TINYINT,
    city VARCHAR(50)
)
DISTRIBUTED BY HASH(user_id) BUCKETS 8  -- –ò–¥–µ–Ω—Ç–∏—á–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
PROPERTIES (
    "colocate_with" = "user_group",      -- –¢–∞ –∂–µ –≥—Ä—É–ø–ø–∞
    "replication_num" = "3"
);
```

### üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Common Bucketing Column

`Common bucketing column` ‚Äì —ç—Ç–æ **—Å—Ç–æ–ª–±–µ—Ü —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `DISTRIBUTED BY HASH` –∏ –æ–±–ª–∞–¥–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Colocate Join –∏–º–µ–Ω–Ω–æ –ø–æ —ç—Ç–æ–º—É —Å—Ç–æ–ª–±—Ü—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü.

**–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–±—â–µ–º—É —Å—Ç–æ–ª–±—Ü—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:**

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
| :--- | :--- |
| **–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö** | –°—Ç–æ–ª–±—Ü—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö (INT, VARCHAR –∏ —Ç.–¥.). |
| **–û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∫–µ—Ç–æ–≤** | –ß–∏—Å–ª–æ, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ `BUCKETS`, –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å. |
| **–û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ (`replication_num`) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º. |

### üí° –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø—ã –∫–æ–ª–æ–∫–∞—Ü–∏–∏:**
```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–µ
SHOW PROC '/colocation_group';

-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –Ω–æ–¥–∞–º
SHOW PROC '/colocation_group/db_id.group_id';
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —Å Colocate Join:**
```sql
SELECT 
    u.user_name, 
    COUNT(a.item_id) as action_count
FROM 
    user_actions a
JOIN 
    user_profiles u ON a.user_id = u.user_id  -- JOIN –ø–æ common bucketing column
WHERE 
    u.city = 'Moscow'
GROUP BY 
    u.user_name;
```

–ü—Ä–∏ —Ç–∞–∫–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –∫–∞–∂–¥–æ–º BE-—É–∑–ª–µ**, —Ç–∞–∫ –∫–∞–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ–±–æ–∏—Ö —Ç–∞–±–ª–∏—Ü —É–∂–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤–º–µ—Å—Ç–µ. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â—É—é –ø–µ—Ä–µ—Å—ã–ª–∫—É –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏ (data shuffling).

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

- **–ò–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è**. –ì–ª–∞–≤–Ω–æ–µ ‚Äì —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Ä—è–¥–∫–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ `DISTRIBUTED BY HASH`
- **–ì—Ä—É–ø–ø–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å `colocate_with`
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø—ã**: –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É —Ä–µ–ø–ª–∏–∫, –≥—Ä—É–ø–ø–∞ –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `Unstable`, –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç –¥–æ –æ–±—ã—á–Ω–æ–≥–æ Shuffle Join
