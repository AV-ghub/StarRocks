# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏
StarRocks –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—á–µ–Ω—å –±–æ–≥–∞—Ç—ã–π –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏, –≤–∫–ª—é—á–∞—è —Ä–∞–±–æ—Ç—É —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –≤–ª–æ–∂–µ–Ω–∏—è–º–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ "—Ä–∞–∑–∂–∞—Ç–∏—è" (UNNEST). –í–æ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å ClickHouse –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏

| –ê—Å–ø–µ–∫—Ç | **StarRocks** | **ClickHouse** |
| :--- | :--- | :--- |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤** | `ARRAY`, `MAP`, `STRUCT`, `JSON`. –ú–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã: `ARRAY<ARRAY<—Ç–∏–ø>>`. | –®–∏—Ä–æ–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä |
| **–î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º** | `–º–∞—Å—Å–∏–≤[–ø–æ–∑–∏—Ü–∏—è]` (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å **1**). | –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å 1 |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ** | `array_contains(–º–∞—Å—Å–∏–≤, —ç–ª–µ–º–µ–Ω—Ç)`, `array_contains_all(arr1, arr2)`, `arrays_overlap(arr1, arr2)`. | –§—É–Ω–∫—Ü–∏–∏ `has`, `hasAll`, `hasAny` |
| **–õ—è–º–±–¥–∞-–≤—ã—Ä–∞–∂–µ–Ω–∏—è** | `array_map(lambda_function, arr1, ...)`, `array_filter(lambda_function, arr1, ...)`. | –§—É–Ω–∫—Ü–∏–∏ –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞ |
| **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤ –º–∞—Å—Å–∏–≤** | `array_agg(–≤—ã—Ä–∞–∂–µ–Ω–∏–µ)`. | –§—É–Ω–∫—Ü–∏—è `groupArray` |

### üí° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ —Ä–∞–∑–∂–∞—Ç–∏—è –º–∞—Å—Å–∏–≤–æ–≤ –≤ StarRocks

StarRocks –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ —Ç–∏–ø–∞ `ARRAY`, –Ω–µ —Ç—Ä–µ–±—É—è —Ä–∞–∑–∂–∞—Ç–∏—è.

#### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
SELECT array_contains(['apple', 'orange', 'pear'], 'orange'); -- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ arr1 —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã arr2
SELECT array_contains_all(['apple', 'orange', 'pear'], ['orange', 'banana']); -- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º–∞—Å—Å–∏–≤—ã –∏–º–µ—é—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ–±—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
SELECT arrays_overlap([1,2,3], [3,4,5]); -- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1
```

#### **–õ—è–º–±–¥–∞-–≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

```sql
-- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–∞—Å—Å–∏–≤–∞
SELECT array_map(x -> x * 2, [1, 2, 3]); -- –†–µ–∑—É–ª—å—Ç–∞—Ç: [2, 4, 6]

-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞
SELECT array_filter(x -> x > 1, [1, 2, 3]); -- –†–µ–∑—É–ª—å—Ç–∞—Ç: [2, 3]
```

#### **–†–∞–±–æ—Ç–∞ —Å –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏**

```sql
-- –î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤
SELECT [[1,2],[3,4]][2][1]; -- –†–µ–∑—É–ª—å—Ç–∞—Ç: 3

-- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤
SELECT array_concat([1,2], [3,4]); -- –†–µ–∑—É–ª—å—Ç–∞—Ç: [1,2,3,4]
```

### üîÑ –ê–Ω–∞–ª–æ–≥ `join array` –≤ StarRocks

–ü—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ ClickHouse `ARRAY JOIN` –≤ StarRocks –Ω–µ—Ç. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ –≤ –Ω–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è **`UNNEST`**.

```sql
-- UNNEST –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –º–∞—Å—Å–∏–≤ –≤ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
SELECT user_id, unnest(tags) as single_tag 
FROM user_table;

-- –ü—Ä–∏–º–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏
SELECT user_id, unnest(ids) as id, unnest(names) as name 
FROM user_table;
```

–í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ `UNNEST` –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π, –∏ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –±–µ–∑ –∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

### üíé –ò—Ç–æ–≥

- **StarRocks** –æ–±–ª–∞–¥–∞–µ—Ç –∑—Ä–µ–ª–æ–π –∏ –º–æ—â–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å **–º–∞—Å—Å–∏–≤–∞–º–∏**, –≤–∫–ª—é—á–∞—è –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ.
- –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π **–±–µ–∑ —Ä–∞–∑–∂–∞—Ç–∏—è –º–∞—Å—Å–∏–≤–æ–≤** –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—á–µ–Ω—å –±–æ–≥–∞—Ç—ã –∏ —Å—Ä–∞–≤–Ω–∏–º—ã —Å ClickHouse.
- –ü—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ **`ARRAY JOIN`** –Ω–µ—Ç, –µ–≥–æ –∑–∞–º–µ–Ω—è–µ—Ç —Ç–∞–±–ª–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è **`UNNEST`**.
